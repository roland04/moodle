define("mod_feedback/edit",["exports","jquery","core/loadingicon","core/notification","core/pending","core/prefetch","core/sortable_list","core/str","core/toast","./local/repository"],(function(_exports,_jquery,_loadingicon,_notification,_pending,_prefetch,_sortable_list,_str,_toast,_repository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_sortable_list=_interopRequireDefault(_sortable_list);const Selectors_deleteQuestionButton='[data-action="delete"]',Selectors_sortableListRegion='[data-region="questions-sortable-list"]',Selectors_sortableElement='[data-region="questions-sortable-list"] .feedback_itemlist[id]',Selectors_sortableElementTitle='[data-region="item-title"]',getItemOrder=element=>{const sortableList=element.closest(Selectors_sortableListRegion);let itemOrder=[];return sortableList.querySelectorAll(Selectors_sortableElement).forEach((item=>{var id;itemOrder.push((id=item.id,Number(id.replace(/^.*feedback_item_/i,""))))})),itemOrder.toString()};let initialized=!1,moduleId=null;_exports.init=cmId=>{if(moduleId=cmId,initialized)return;(0,_prefetch.prefetchStrings)("core",["yes","no"]),(0,_prefetch.prefetchStrings)("admin",["confirmation"]),(0,_prefetch.prefetchStrings)("mod_feedback",["confirmdeleteitem","questionmoved"]),document.addEventListener("click",(event=>{const deleteButton=event.target.closest(Selectors_deleteQuestionButton);if(deleteButton){event.preventDefault();const targetUrl=deleteButton.getAttribute("href"),requiredStrings=[{key:"confirmation",component:"admin"},{key:"confirmdeleteitem",component:"mod_feedback"},{key:"yes",component:"core"},{key:"no",component:"core"}];(0,_str.getStrings)(requiredStrings).then((_ref=>{let[confirmation,confirmdeleteitem,yes,no]=_ref;return _notification.default.confirm(confirmation,confirmdeleteitem,yes,no,(()=>{window.location=targetUrl}))})).catch(_notification.default.exception)}}));new _sortable_list.default(document.querySelector(Selectors_sortableListRegion)).getElementName=element=>{var _element$0$querySelec;return Promise.resolve(null===(_element$0$querySelec=element[0].querySelector(Selectors_sortableElementTitle))||void 0===_element$0$querySelec?void 0:_element$0$querySelec.textContent)},(0,_jquery.default)(document).on(_sortable_list.default.EVENTS.DROP,Selectors_sortableElement,((event,info)=>{if(info.positionChanged){const pendingPromise=new _pending.default("mod_feedback/questions:reorder"),itemOrder=getItemOrder(info.element[0]);(0,_repository.reorderQuestions)(moduleId,itemOrder).then((0,_loadingicon.addIconToContainerRemoveOnCompletion)(info.element[0],pendingPromise)).then((()=>(0,_str.getString)("questionmoved","mod_feedback"))).then(_toast.add).then((()=>pendingPromise.resolve())).catch(_notification.default.exception)}})),initialized=!0}}));

//# sourceMappingURL=edit.min.js.map